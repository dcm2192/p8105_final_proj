---
title: "weather!"
author: "Dylan Morgan"
output: github_document
---

Load packages.
```{r}
library(tidyverse)
library(ggmap)
```

Elk data from Wayne.
```{r}
elk = read_csv("./data/elk.csv")
```

Load and clean up weather data.
```{r}
raw_weather <- read_csv("./data/raw_weather_data.csv")
```

Plot weather stations and elk migration pathways to determine which stations to use.
```{r}
weather_stations <-
  raw_weather |>
  group_by(NAME, LATITUDE, LONGITUDE) |>
  summarize(n_obs = n())

ggplot() +
  geom_path(
    data = elk,
    aes(x=long, y=lat),
    alpha = 0.5,
    color = "red") +
  geom_point(data = weather_stations, aes(x = LONGITUDE, y = LATITUDE))


ggplot(data = weather_stations,
         aes(x = LONGITUDE, y = LATITUDE)) +
  geom_point() +
  ggrepel::geom_label_repel(aes(label = NAME),
                            box.padding   = 0.35,
                            point.padding = 0.5,
                            segment.color = 'grey50',
                            max.overlaps = 20)

potential_stations <- 
  c("LEWIS LAKE DIVIDE, WY US", "SNAKE RIVER, WY US", "SNAKE RIVER STATION, WY US", "BASE CAMP, WY US", 
    "MORAN 5 WNW, WY US", "JACKSON 29.9 NNE, WY US", "BURRO HILL WYOMING, WY US", "MOOSE 1 NNE, WY US", 
    "MOOSE, WY US", "MOOSE .4 S, WY US", "JACKSON 12.3 NE, WY US", "JACKSON 12.2 NE, WY US", 
    "JACKSON HOLE AIRPORT, WY US", "JACKSON, WY US")

four_stations <- 
  c("SNAKE RIVER STATION, WY US", "MORAN 5 WNW, WY US", "BURRO HILL WYOMING, WY US", "MOOSE 1 NNE, WY US")

reduced_weather_stations <- 
  raw_weather |> 
  filter(NAME %in% four_stations) |> 
  group_by(NAME, LATITUDE, LONGITUDE) |> 
  summarize(n_obs = n()) |> 
  arrange(desc(n_obs)) 

four_stations_labels_plot <- 
  ggplot(data = reduced_weather_stations,
         aes(x = LONGITUDE, y = LATITUDE)) +
  geom_point() +
  ggrepel::geom_label_repel(aes(label = NAME),
                            box.padding   = 0.35,
                            point.padding = 0.5,
                            segment.color = 'grey50',
                            max.overlaps = 20)

four_stations_labels_plot

ggsave(path = "./plots/", 
       filename = "four_stations_labels_plot.png", 
       plot = four_stations_labels_plot)

four_stations_elk_mvmt_plot <- 
  ggplot() +
  geom_path(
    data = elk,
    aes(x=long, y=lat),
    alpha = 0.5,
    color = "red") +
  geom_point(data = reduced_weather_stations, aes(x = LONGITUDE, y = LATITUDE))
  
four_stations_elk_mvmt_plot

ggsave(path = "./plots/", 
       filename = "four_stations_elk_mvmt_plot.png", 
       plot = four_stations_elk_mvmt_plot)
```

Reduce weather station data, explore weather data.
```{r}
reduced_weather <- 
  raw_weather |> 
  filter(NAME %in% four_stations)

# reduced_weather |>
#   group_by(NAME) |> 
#   pivot_longer(
#     TAVG:TMIN, 
#     names_to = "temp_class", 
#     values_to = "temp") |> 
#   select(-c(WDF2:WT11)) |> 
#   ggplot(aes(x = DATE, y = temp, color = temp_class)) + 
#     geom_point() + 
#   facet_grid(~factor(NAME))

```

Are there any differences in weather patterns observed among the different stations that could have influenced elk movement patterns?

What kinds of monthly weather patterns were visible over this time period?

Were there any extreme weather events that occurred?

Find patterns in temp, rainfall, snowfall over time. Factor by month. Avg rainfall total, snowfall total, snow depth total, temp avg.

*Histogram or barchart?*

Histogram of total precip
Histogram of precip by year
Histogram of precip by month
Compared to histogram of elk movement by month
Histogram of total snowfall
Histogram of snowfall by year
Histogram of snowfall by month
Compared to Histogram of Elk movement by month 
Histogram of daily temperatures by year
Histogram of daily temperatures by month
Scatterplot of daily elk movement versus snowfall
Scatterplot of daily elk movement versus snowdepth
Scatterplot of daily elk movement versus temperature

Total precip -- avg totals among the four stations.
Three ways to show data: faceted bar chart per year, point + line graph per year, year-month bar chart separated by year
```{r}
# faceted bar chart, separated by month and year
reduced_weather |> 
  select(c(STATION, NAME, LATITUDE, LONGITUDE, DATE, PRCP, SNOW, SNWD, TAVG)) |> 
  mutate(year = format(DATE, "%Y"), 
         month = format(DATE, "%m")) |> 
  group_by(NAME, year, month) |> 
  summarize(station_precip_total = sum(PRCP, na.rm = TRUE)) |> 
  group_by(year, month) |> 
  summarize(station_precip_total_avg = mean(station_precip_total, na.rm = TRUE)) |> 
  mutate(year_month = paste(year, month, sep = "-")) |> 
  ggplot(aes(x = month, y = station_precip_total_avg, fill = as.factor(year))) +
  geom_bar(stat = "identity") + 
  facet_wrap(vars(year), ncol = 2) + 
  theme(legend.position = "none")

# point + line, separated by month and year
reduced_weather |> 
  select(c(STATION, NAME, LATITUDE, LONGITUDE, DATE, PRCP, SNOW, SNWD, TAVG)) |> 
  mutate(year = format(DATE, "%Y"), 
         month = format(DATE, "%m")) |> 
  group_by(NAME, year, month) |> 
  summarize(station_precip_total = sum(PRCP, na.rm = TRUE)) |> 
  group_by(year, month) |> 
  summarize(station_precip_total_avg = mean(station_precip_total, na.rm = TRUE)) |> 
  mutate(year_month = paste(year, month, sep = "-")) |> 
  ggplot(aes(x = month, y = station_precip_total_avg, color = year, group = year)) + 
  geom_point(size = 2) + 
  geom_line(linewidth = 1)

# year-month totals, separated by year
reduced_weather |> 
  select(c(STATION, NAME, LATITUDE, LONGITUDE, DATE, PRCP, SNOW, SNWD, TAVG)) |> 
  mutate(year = format(DATE, "%Y"), 
         month = format(DATE, "%m")) |> 
  group_by(NAME, year, month) |> 
  summarize(station_precip_total = sum(PRCP, na.rm = TRUE)) |> 
  group_by(year, month) |> 
  summarize(station_precip_total_avg = mean(station_precip_total, na.rm = TRUE)) |> 
  mutate(year_month = paste(year, month, sep = "-")) |> 
  ggplot(aes(x = year_month, y = station_precip_total_avg, fill = as.factor(year))) +
  geom_bar(stat = "identity") + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

Do the same for snowfall.
```{r}
# faceted bar chart, separated by month and year
reduced_weather |> 
  select(c(STATION, NAME, LATITUDE, LONGITUDE, DATE, PRCP, SNOW, SNWD, TAVG)) |> 
  mutate(year = format(DATE, "%Y"), 
         month = format(DATE, "%m")) |> 
  group_by(NAME, year, month) |> 
  summarize(station_snowfall_total = sum(SNOW, na.rm = TRUE)) |> 
  group_by(year, month) |> 
  summarize(station_snowfall_total_avg = mean(station_snowfall_total, na.rm = TRUE)) |> 
  mutate(year_month = paste(year, month, sep = "-")) |> 
  ggplot(aes(x = month, y = station_snowfall_total_avg, fill = as.factor(year))) +
  geom_bar(stat = "identity") + 
  facet_wrap(vars(year), ncol = 2) + 
  theme(legend.position = "none")

# point + line
reduced_weather |> 
  select(c(STATION, NAME, LATITUDE, LONGITUDE, DATE, PRCP, SNOW, SNWD, TAVG)) |> 
  mutate(year = format(DATE, "%Y"), 
         month = format(DATE, "%m")) |> 
  group_by(NAME, year, month) |> 
  summarize(station_snowfall_total = sum(SNOW, na.rm = TRUE)) |> 
  group_by(year, month) |> 
  summarize(station_snowfall_total_avg = mean(station_snowfall_total, na.rm = TRUE)) |> 
  mutate(year_month = paste(year, month, sep = "-")) |> 
  ggplot(aes(x = month, y = station_snowfall_total_avg, color = year, group = year)) + 
  geom_point(size = 2) + 
  geom_line(linewidth = 1)

# year-month totals by year
reduced_weather |> 
  select(c(STATION, NAME, LATITUDE, LONGITUDE, DATE, PRCP, SNOW, SNWD, TAVG)) |> 
  mutate(year = format(DATE, "%Y"), 
         month = format(DATE, "%m")) |> 
  group_by(NAME, year, month) |> 
  summarize(station_snowfall_total = sum(SNOW, na.rm = TRUE)) |> 
  group_by(year, month) |> 
  summarize(station_snowfall_total_avg = mean(station_snowfall_total, na.rm = TRUE)) |> 
  mutate(year_month = paste(year, month, sep = "-")) |> 
  ggplot(aes(x = year_month, y = station_snowfall_total_avg, fill = as.factor(year))) + 
  geom_bar(stat = "identity") + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

