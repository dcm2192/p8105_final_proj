---
title: "Water Quality Analysis"
author: "Tamara Pichardo"
output: html_document
---


## Load Packages
```{r}
library(tidyverse)
library(ggmap)
library(plotly)
```

```{r}
knitr::opts_chunk$set(
        echo = TRUE,
        warning = FALSE,
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() +theme(legend.position = "bottom"))

options(
  ggplot2.continuous.color = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_color_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```


## Read in Data

```{r}
elk = read.csv(file = "./data/elk.csv") |> 
  mutate(date = as.Date(paste(year, month, day, sep = "-")))

water_quality = read.csv(file = "./data/water_quality.csv") |> 
  mutate(date = as.Date(paste(year, month, day, sep = "-"))) |> 
  filter(location_id %in% c("GRTE_SNR01", "GRTE_SNR02", "YELL_LM000.5M", "YELL_YS549.7M", "YELL_MD133.2T", "YELL_MDR"))
```


## Water Quality

- The `year`, `month`, and `day` variables give the time. 
- The `latitude` and `longitude` give the location. 
- `characteristic_name` gives the type of measurement. 
- `result_text` gives the measurement. 

```{r}
head(water_quality)
```

This is an incredibly rich data set. I have only kept the 20 most common quantitative measurements, but there are so many more. I have kept this data set in the long format, because there is very spotty measuring. 

```{r}
water_quality |> 
  group_by(characteristic_name) |> 
  summarize(n = n()) |> 
  arrange(desc(n))
```


### Water Quality pH

This code chunk filters for all measurements of pH. `result_text` is a character vector, so make sure to change the vector to a numeric type if you're working with numeric data, like pH

```{r}
calcium = 
  water_quality |> 
  filter(characteristic_name == 'Calcium mg/l') |> 
  mutate(calcium = as.numeric(result_text)) # turning the vector numeric


calcium |>    
  ggplot(aes(x = calcium)) + 
  geom_histogram()
```


## Create a static map plot

[using ggmap](https://www.nceas.ucsb.edu/sites/default/files/2020-04/ggmapCheatsheet.pdf)

[from stack exchange](https://stackoverflow.com/questions/33942186/using-r-and-ggplot-to-draw-separate-lines-between-gps-coordinates/33944974)


### Step 1: Download map

Find the minimum and maximum latitude and longitude of elk's journey. This will give us the range of map to download.

```{r}
min_lat = elk |> pull(lat) |> min()
max_lat = elk |> pull(lat) |> max()
rng_lat = abs(min_lat - max_lat)
lowerleftlat = min_lat 
upperrightlat = max_lat 


min_long = elk |> pull(long) |> min()
max_long = elk |> pull(long) |> max()
rng_long = abs(min_long - max_long)
lowerleftlon = min_long - rng_long 
upperrightlon = max_long + rng_long

myLocation <- c(left = lowerleftlon,
                 bottom = lowerleftlat,
                 right = upperrightlon,
                 top = upperrightlat)
```


```{r}
register_stadiamaps(key = '29074900-bb6e-4a71-8f91-454c28190f88', write = FALSE)

myMap <- get_stadiamap(
  bbox=myLocation,
  maptype = "stamen_terrain",
  crop=FALSE)
```

### Step 2: Plot map with elk movement
```{r}
ggmap(myMap) +
geom_path(
  data = elk, 
  aes(x=long, y=lat, color = month))+
  geom_line(alpha = 0) +
  scale_color_gradientn(colours = rainbow(12))
```


```{r}
ggplot(
  data = elk, 
  aes(x=long, y=lat)) +
geom_path(alpha = 0.5) +
geom_line(alpha = 0) +
geom_point(
  data = calcium,
  aes(x = longitude, y = latitude, color = 'red')
  )
```

Add in water calcium
```{r}
ggmap(myMap) +
geom_path(
  data = elk, 
  aes(x=long, y=lat, color = month))+
  geom_line(alpha = 0) +
  scale_color_gradientn(colours = rainbow(12)) +
geom_point(
  data = calcium,
  aes(x = longitude, y = latitude)
)
```




```{r}
arsenic = 
  water_quality |> 
  filter(characteristic_name == 'Arsenic mg/l') |> 
  mutate(arsenic = as.numeric(result_text)) 


ggplot(arsenic, aes(x = date, y = arsenic, color = location_id)) +
  geom_point(alpha = 0.6) +
  labs(
    title = "Scatter Plot of Arsenic Levels Over Time", 
    x = "Date", 
    y = "Arsenic (mg/l)") +
  theme(legend.position = "right")
```

```{r}
chloride = 
  water_quality |> 
  filter(characteristic_name == 'Chloride mg/l') |> 
  mutate(chloride = as.numeric(result_text))


ggplot(chloride, aes(x = date, y = chloride, color = location_id)) +
  geom_point(alpha = 0.6) +
  labs(
    title = "Scatter Plot of Chloride Levels Over Time", 
    x = "Date", 
    y = "Chloride (mg/l)") +
  theme(legend.position = "right")
```

```{r}
dissolved_oxygen = 
  water_quality |> 
  filter(characteristic_name == 'Dissolved oxygen (DO) mg/l') |> 
  mutate(dissolved_oxygen = as.numeric(result_text)) 


ggplot(dissolved_oxygen, aes(x = date, y = dissolved_oxygen, color = location_id)) +
  geom_point(alpha = 0.6) +
  labs(
    title = "Scatter Plot of Dissolved Oxygen Levels Over Time", 
    x = "Date", 
    y = "Dissolved Oxygen (DO) mg/l") +
  theme(legend.position = "right")
```

```{r}
magnesium = 
  water_quality |> 
  filter(characteristic_name == 'Magnesium mg/l') |> 
  mutate(magnesium = as.numeric(result_text)) 


ggplot(magnesium, aes(x = date, y = magnesium, color = location_id)) +
  geom_point(alpha = 0.6) +
  labs(
    title = "Scatter Plot of Magnesium Levels Over Time", 
    x = "Date", 
    y = "Magnesium (mg/l)") +
  theme(legend.position = "right")
```

```{r}
nitrogen = 
  water_quality |> 
  filter(characteristic_name == 'Nitrogen, ammonia as N mg/l') |> 
  mutate(nitrogen = as.numeric(result_text)) 


ggplot(nitrogen, aes(x = date, y = nitrogen, color = location_id)) +
  geom_point(alpha = 0.6) +
  labs(
    title = "Scatter Plot of Nitrogen Levels Over Time", 
    x = "Date", 
    y = "Nitrogen (mg/l)") +
  theme(legend.position = "right")
```

```{r}
phosphorus = 
  water_quality |> 
  filter(characteristic_name == 'Phosphorus as P mg/l') |> 
  mutate(phosphorus = as.numeric(result_text)) 


ggplot(phosphorus, aes(x = date, y = phosphorus, color = location_id)) +
  geom_point(alpha = 0.6) +
  labs(
    title = "Scatter Plot of Phosphorus Levels Over Time", 
    x = "Date", 
    y = "Phosphorus (mg/l)") +
  theme(legend.position = "right")
```

```{r}
potassium = 
  water_quality |> 
  filter(characteristic_name == 'Potassium mg/l') |> 
  mutate(potassium = as.numeric(result_text)) 


ggplot(potassium, aes(x = date, y = potassium, color = location_id)) +
  geom_point(alpha = 0.6) +
  labs(
    title = "Scatter Plot of Potassium Levels Over Time", 
    x = "Date", 
    y = "Potassium (mg/l)") +
  theme(legend.position = "right")
```

```{r}
sodium = 
  water_quality |> 
  filter(characteristic_name == 'Sodium mg/l') |> 
  mutate(sodium = as.numeric(result_text)) 


ggplot(sodium, aes(x = date, y = sodium, color = location_id)) +
  geom_point(alpha = 0.6) +
  labs(
    title = "Scatter Plot of Sodium Levels Over Time", 
    x = "Date", 
    y = "Sodium (mg/l)") +
  theme(legend.position = "right")
```

```{r}
sulfur = 
  water_quality |> 
  filter(characteristic_name == 'Sulfur, sulfate (SO4) as SO4 mg/l') |> 
  mutate(sulfur = as.numeric(result_text))


ggplot(sulfur, aes(x = date, y = sulfur, color = location_id)) +
  geom_point(alpha = 0.6) +
  labs(
    title = "Scatter Plot of Sulfur Levels Over Time", 
    x = "Date", 
    y = "Sulfur (mg/l)") +
  theme(legend.position = "right")
```


```{r}
water_temp = 
  water_quality |> 
  filter(characteristic_name == 'Temperature, water deg C') |> 
  mutate(water_temp = as.numeric(result_text)) 


ggplot(water_temp, aes(x = date, y = water_temp, color = location_id)) +
  geom_point(alpha = 0.6) +
  labs(
    title = "Scatter Plot of Water Temperature Levels Over Time", 
    x = "Date", 
    y = "Water Temperature deg C") +
  theme(legend.position = "right")


```

```{r}
water_ph = 
  water_quality |> 
  filter(characteristic_name == 'pH') |> 
  mutate(water_ph = as.numeric(result_text)) 


ggplot(water_ph, aes(x = date, y = water_ph, color = location_id)) +
  geom_point(alpha = 0.6) +
  labs(
    title = "Scatter Plot of pH Levels Over Time", 
    x = "Date", 
    y = "pH") +
  theme(legend.position = "right")

water_ph |> 
  mutate(text_label = str_c("Location: ", location_name, "pH Level: ", result_text)) |> 
  plot_ly(
    x = ~latitude, 
    y = ~longitude, 
    type = "scatter", 
    mode = "markers",
    color = ~location_name, 
    text = ~text_label, 
    alpha = 0.5, 
    hoverinfo = "text")
```


Water Quality Characteristics Over Time
```{r}
location_data = water_quality |> 
  filter(characteristic_name %in% c("Arsenic mg/l", "Chloride mg/l", "Dissolved oxygen (DO) mg/l", "Magnesium mg/l", "Nitrogen, ammonia as N mg/l", "Phosphorus as P mg/l", "Potassium mg/l", "Sodium mg/l", "Sulfur, sulfate (SO4) as SO4 mg/l", "pH", "Temperature, water deg C")) |> 
  mutate(result_text = as.numeric(result_text))
```

```{r}
ggplot(location_data, aes(x = date, y = result_text)) +
  geom_line(aes(color = location_id), size = 0.5) +
  facet_wrap(~ characteristic_name, scales = "free_y") +
  labs(
    title = "Water Quality Over Time",
    x = "Date",
    y = "Characteristic"
  ) +
  scale_colour_viridis_d()
```


