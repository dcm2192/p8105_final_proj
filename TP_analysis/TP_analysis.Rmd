---
title: "TP_analysis"
output: github_document
---


## Load Packages
```{r}
library(tidyverse)
library(ggmap)
library(shiny)
```



## Read in Data

```{r}
elk = read.csv(file = "./clean_data/elk.csv")
water_quality = read.csv(file = "./clean_data/water_quality.csv")
```

## Elk Data

Each elk has an `elk_id`. The `year`, `month`, `day`, and `hour` give the time. The `lat` and `long` give the location.

```{r}
head(elk)
```
## Water Quality

- The `year`, `month`, and `day` variables give the time. 
- The `latitude` and `longitude` give the location. 
- `characteristic_name` gives the type of measurement. 
- `result_text` gives the measurement. 

```{r}
head(water_quality)
```

This is an incredibly rich data set. I have only kept the 20 most common quantitative measurements, but there are so many more. I have kept this data set in the long format, because there is very spotty measuring. 

```{r}
water_quality |> 
  group_by(characteristic_name) |> 
  summarize(n = n()) |> 
  arrange(desc(n))
```


### Water Quality pH

This code chunk filters for all measurements of pH. `result_text` is a character vector, so make sure to change the vector to a numeric type if you're working with numeric data, like pH

```{r}
calcium = 
  water_quality |> 
  filter(characteristic_name == 'Calcium mg/l') |> 
  mutate(calcium = as.numeric(result_text)) # turning the vector numeric


calcium |>    
  ggplot(aes(x = calcium)) + 
  geom_histogram()
```


## Create a static map plot

[using ggmap](https://www.nceas.ucsb.edu/sites/default/files/2020-04/ggmapCheatsheet.pdf)

[from stack exchange](https://stackoverflow.com/questions/33942186/using-r-and-ggplot-to-draw-separate-lines-between-gps-coordinates/33944974)


### Step 1: Download map

Find the minimum and maximum latitude and longitude of elk's journey. This will give us the range of map to download.

```{r}
min_lat = elk |> pull(lat) |> min()
max_lat = elk |> pull(lat) |> max()
rng_lat = abs(min_lat - max_lat)
lowerleftlat = min_lat 
upperrightlat = max_lat 


min_long = elk |> pull(long) |> min()
max_long = elk |> pull(long) |> max()
rng_long = abs(min_long - max_long)
lowerleftlon = min_long - rng_long 
upperrightlon = max_long + rng_long

myLocation <- c(left = lowerleftlon,
                 bottom = lowerleftlat,
                 right = upperrightlon,
                 top = upperrightlat)
```


```{r}
register_stadiamaps(key = '29074900-bb6e-4a71-8f91-454c28190f88', write = FALSE)

myMap <- get_stadiamap(
  bbox=myLocation,
  maptype = "stamen_terrain",
  crop=FALSE)
```

### Step 2: Plot map with elk movement
```{r}
ggmap(myMap) +
geom_path(
  data = elk, 
  aes(x=long, y=lat, color = month))+
  geom_line(alpha = 0) +
  scale_color_gradientn(colours = rainbow(12))
```


```{r}
ggplot(
  data = elk, 
  aes(x=long, y=lat)) +
geom_path(alpha = 0.5) +
geom_line(alpha = 0) +
geom_point(
  data = calcium,
  aes(x = longitude, y = latitude, color = 'red')
  )
```

Add in water calcium
```{r}
ggmap(myMap) +
geom_path(
  data = elk, 
  aes(x=long, y=lat, color = month))+
  geom_line(alpha = 0) +
  scale_color_gradientn(colours = rainbow(12)) +
geom_point(
  data = calcium,
  aes(x = longitude, y = latitude)
)
```




```{r}
arsenic = 
  water_quality |> 
  filter(characteristic_name == 'Arsenic mg/l') |> 
  mutate(arsenic = as.numeric(result_text)) 


arsenic |>    
  ggplot(aes(x = arsenic)) + 
  geom_histogram()
```

```{r}
chloride = 
  water_quality |> 
  filter(characteristic_name == 'Chloride mg/l') |> 
  mutate(chloride = as.numeric(result_text))


chloride |>    
  ggplot(aes(x = chloride)) + 
  geom_histogram()
```

```{r}
dissolved_oxygen = 
  water_quality |> 
  filter(characteristic_name == 'Dissolved oxygen (DO) mg/l') |> 
  mutate(dissolved_oxygen = as.numeric(result_text)) 


dissolved_oxygen |>    
  ggplot(aes(x = dissolved_oxygen)) + 
  geom_histogram()
```

```{r}
magnesium = 
  water_quality |> 
  filter(characteristic_name == 'Magnesium mg/l') |> 
  mutate(magnesium = as.numeric(result_text)) 


magnesium |>    
  ggplot(aes(x = magnesium)) + 
  geom_histogram()
```

```{r}
nitrogen = 
  water_quality |> 
  filter(characteristic_name == 'Nitrogen, ammonia as N mg/l') |> 
  mutate(nitrogen = as.numeric(result_text)) 


nitrogen |>    
  ggplot(aes(x = nitrogen)) + 
  geom_histogram()
```

```{r}
phosphorus = 
  water_quality |> 
  filter(characteristic_name == 'Phosphorus as P mg/l') |> 
  mutate(phosphorus = as.numeric(result_text)) 


phosphorus |>    
  ggplot(aes(x = phosphorus)) + 
  geom_histogram()
```

```{r}
potassium = 
  water_quality |> 
  filter(characteristic_name == 'Potassium mg/l') |> 
  mutate(potassium = as.numeric(result_text)) 


potassium |>    
  ggplot(aes(x = potassium)) + 
  geom_histogram()
```

```{r}
sodium = 
  water_quality |> 
  filter(characteristic_name == 'Sodium mg/l') |> 
  mutate(sodium = as.numeric(result_text)) 


sodium |>    
  ggplot(aes(x = sodium)) + 
  geom_histogram()
```

```{r}
sulfur = 
  water_quality |> 
  filter(characteristic_name == 'Sulfur, sulfate (SO4) as SO4 mg/l') |> 
  mutate(sulfur = as.numeric(result_text))


sulfur |>    
  ggplot(aes(x = sulfur)) + 
  geom_histogram()
```


```{r}
air_temp = 
  water_quality |> 
  filter(characteristic_name == 'Temperature, air deg C') |> 
  mutate(air_temp = as.numeric(result_text)) 


air_temp |>    
  ggplot(aes(x = air_temp)) + 
  geom_histogram()
```

```{r}
water_temp = 
  water_quality |> 
  filter(characteristic_name == 'Temperature, water deg C') |> 
  mutate(water_temp = as.numeric(result_text)) 


water_temp |>    
  ggplot(aes(x = water_temp)) + 
  geom_histogram()
```

```{r}
water_ph = 
  water_quality |> 
  filter(characteristic_name == 'pH') |> 
  mutate(water_ph = as.numeric(result_text)) 


water_ph |>    
  ggplot(aes(x = water_ph)) + 
  geom_histogram()
```


```{r}
ui = fluidPage(
  titlePanel("Elk Movement and Water Quality Over Time"),
  
  sidebarLayout(
    sidebarPanel(
      sliderInput("month_slider",
                  "Select Month:",
                  min = ,
                  selected = "2023"),
      
      selectInput("characteristic", 
                  "Select Water Quality Characteristic:", 
                  choices = unique(water_quality$characteristic_name),
                  selected = "Calcium mg/l")
    ),
    
    mainPanel(
      plotOutput("elkMap"),
      textOutput("summary")
    )
  )
)
```

```{r}
server = function(inout, output) {}
```


```{r}
output$elkMap = renderPlot({
  data = filtered_data()
  
  ggplot(water_quality, aes(x = month, y = calcium)) +
    geom_point() +
    geom_line() +
    labs(
      title = paste("Water Quality in:", input$month, input$year),
      x = "Date",
      y = "Water Quality (calcium)"
    )
})
```

```{r}
shinyApp(ui = ui, server = server)
```
