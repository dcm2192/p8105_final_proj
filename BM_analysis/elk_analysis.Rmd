---
title: "Elk Migration"
author: "Brooklynn McNeil"
date: "2024-11-18"
output: html_document
---

Load packages and set options.

```{r setup, include=FALSE}
library(tidyverse)
library(geosphere)

knitr::opts_chunk$set(
  comment = '', fig.width = 8, fig.height = 6, out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

Import elk migration data.

```{r}
elk_df = read_csv("../clean_data/elk.csv") |>
  mutate(datetime = make_datetime(year, month, day, hour),
         elk_id = factor(elk_id)) |>
  select(elk_id, datetime, lat, long)

elk_df
```
The elk IDs are: `r unique(elk_df$elk_id)`, and we are going to follow them around Yellowstone! I found a cute picture of an elk in the snow  [here](https://powertraveller.com/yellowstone-winter-wildlife-safari-from-gardiner/)

<img src="pics/elk.png" style="width:75%"/>

## Exploratory Analysis of Elk Migration

Some questions we want to answer about the elk:

- Do the 17 elk move together as a pack or separately?
- Do the migration patterns change by year?
- Does time of year change the migration patterns?
- what is the average total length of yearly migration? daily? monthly?
- How wide or narrow are the migration routes?
- Are there any areas that all of the elk go to?
- are the elk likely to have the same paths or go elsewhere?

Fun stuff I want to do
- Make a moving map of the elk

Let's plot where the elk are on the map!

```{r}
elk_df |>
  mutate(year = year(datetime)) |>
  filter(year >= 2014) |>
  ggplot(aes(x = lat, y = long, color = elk_id)) + 
  geom_point(alpha = 0.3) +
  facet_grid(~ year) +  
  labs(
    title = "Elk Migration by Year (2014 and later)",
    x = "Latitude",
    y = "Longitude",
    color = "Elk ID"
  ) +
  theme_minimal()
```

Now let's look at how far they travel throughout the year. 

```{r}
#calculate the distance they travel each month
elk_seasonal <- elk_df |>
  mutate(
    year = year(datetime),  # Extract year
    month = month(datetime),  # Extract month
    season = case_when(
      month %in% c(12, 1, 2) ~ "Winter",
      month %in% c(3, 4, 5) ~ "Spring",
      month %in% c(6, 7, 8) ~ "Summer",
      month %in% c(9, 10, 11) ~ "Fall"
    )
  ) |>
  arrange(elk_id, datetime)  # Ensure data is ordered

# Calculate distances and group by year, season, and elk_id
elk_distances_seasonal <- elk_seasonal |>
  group_by(elk_id, year, season) |>
  mutate(
    dist = distHaversine(cbind(long, lat), cbind(lag(long), lag(lat)))  # Distance between consecutive points
  ) |>
  summarize(
    total_distance_km = sum(dist, na.rm = TRUE) / 1000  # Convert to kilometers and sum
  ) |>
  ungroup()

# View results
elk_distances_seasonal
```
Now I am curious what the overlap of the elk are? The data collected is between 2006 and 2015, but we do not have data from all of the elk ids during that time period. It turns out that wild elk can only live up to 10-12 years, according to [worlddeer.ord](https://worlddeer.org/elk/). So let's find out what the time range is for each of these elk.

```{r}
elk_df |>
  group_by(elk_id) |>
  summarize(start_time = min(datetime),
            end_time = max(datetime)) |>
  knitr::kable()

elk_df_2013.2014 = 
  elk_df |>
  filter(datetime >= as_date("2013-07-16") &
         datetime <= as_date("2014-12-30"),
         elk_id %in% c(907, 909, 911, 913, 914, 916, 917, 918))
```
The most overlapping data occurs between July 16th 2013 and December 30th, 2014. We have 8 elk that have data for this time range: `r unique(elk_df_2013.2014$elk_id)`. Now let's see how they move around!

Plot the seasonal data

```{r}
elk_monthly = elk_df_2013.2014 |>
  mutate(
    year = year(datetime),  
    month = month(datetime, label = TRUE),  
  ) |>
  arrange(elk_id, datetime)  

# Calculate distances and group by year, season, and elk_id
elk_distance_monthly = 
  elk_monthly |>
  group_by(elk_id, year, month) |>
  mutate(
    dist = distHaversine(cbind(long, lat), cbind(lag(long), lag(lat)))  # Distance between consecutive points
  ) |>
  summarize(
    total_distance_km = sum(dist, na.rm = TRUE) / 1000  # Convert to kilometers and sum
  ) |>
  ungroup() 


elk_distance_monthly |>
  ggplot(aes(x = as.numeric(month), y = total_distance_km, color = elk_id)) +
  geom_point() +
  geom_smooth(se = FALSE) +
  scale_x_continuous(
    breaks = 1:12,  # Numeric positions for each month
    labels = month.name  # Use month names as labels
  ) +
  labs(title = "Elk Movement by Month 2013-07-16 to 2014-12-30",
       x = "month",
       y = "total distance (km)")
```
It looks like May and December are when the elk are moving around the most. 

I want to check if the number of observations for each month has an impact on these trends. I'm going to see if normalizing the data based on the number of obersvations has a significant impact on the trends. 

```{r}
elk_distance_normalized = 
  elk_monthly |>
  group_by(elk_id, year, month) |>
  mutate(
    dist = distHaversine(cbind(long, lat), cbind(lag(long), lag(lat)))  # Distance between consecutive points
  ) |>
  summarize(
    total_distance_km = sum(dist, na.rm = TRUE) / 1000,  # Convert to kilometers and sum
    count = n()
  ) |>
  mutate(normal_distance = total_distance_km/count)

elk_distance_normalized |>
  ggplot(aes(x = as.numeric(month), y = normal_distance, color = elk_id)) +
  geom_point() +
  geom_smooth(se = FALSE) +
  scale_x_continuous(
    breaks = 1:12,  # Numeric positions for each month
    labels = month.name  # Use month names as labels
  ) +
  labs(title = "Elk Movement by Month 2013-07-16 to 2014-12-30",
       x = "month",
       y = "normalized distance")
```


